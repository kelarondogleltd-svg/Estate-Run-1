<!DOCTYPE html>
<html>
<head>
  <title>Tenant Portal | Kela Rondogle Ltd</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <style>
    .portal-container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    .card {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 6px;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      margin-bottom: 10px;
    }
    .btn {
      display: inline-block;
      background: #2563eb;
      color: white;
      padding: 10px 15px;
      text-decoration: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<header>
  <h1>Tenant Portal</h1>
  <p>Access your tenancy documents and report maintenance issues</p>
  <button class="btn" onclick="logout()">Logout</button>
</header>

<div class="portal-container">
  <!-- Signed Tenancy Agreement -->
  <div class="card">
    <h2>Signed Tenancy Agreement</h2>
    <a href="assets/agreements/sample-tenancy.pdf" target="_blank" class="btn">View / Download PDF</a>
  </div>

  <!-- Maintenance Report -->
  <div class="card">
    <h2>Submit Maintenance Report</h2>
    <input type="text" id="issueTitle" placeholder="Issue title" required>
    <textarea id="issueDescription" rows="4" placeholder="Describe the issue" required></textarea>
    <button class="btn" onclick="submitReport()">Submit Report</button>
    <p id="reportMessage" style="color:green;"></p>
  </div>

  <!-- Private Messaging -->
  <div class="card">
    <h2>Private Messages</h2>
    <div id="messagesList">
      <p>No messages yet.</p>
    </div>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // Ensure tenant is logged in
  firebase.auth().onAuthStateChanged(function(user) {
    if (!user) {
      window.location.href = "tenant-login.html"; // redirect if not logged in
    }
  });

  // Logout
  function logout() {
    firebase.auth().signOut().then(() => {
      window.location.href = "tenant-login.html";
    });
  }

  // Submit maintenance report
  function submitReport() {
    const title = document.getElementById('issueTitle').value;
    const desc = document.getElementById('issueDescription').value;
    const user = firebase.auth().currentUser;

    if(!title || !desc) {
      alert("Please fill in all fields.");
      return;
    }

    db.collection("maintenance_reports").add({
      tenantId: user.uid,
      tenantEmail: user.email,
      title: title,
      description: desc,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      status: "pending"
    })
    .then(() => {
      document.getElementById('reportMessage').innerText = "Report submitted successfully!";
      document.getElementById('issueTitle').value = "";
      document.getElementById('issueDescription').value = "";
    })
    .catch((error) => {
      alert("Error submitting report: " + error.message);
    });
  }

</script>

</body>
</html>
